<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<title>Chinachu on CentOS 6.6 + PT3</title>
	</head>
	<body>
		<h1 id="chinachu-on-centos-66--pt3">Chinachu on CentOS 6.6 + PT3</h1>

<h2 id="section">事前準備</h2>

<p>開発ツールを入れる</p>

<pre><code>sudo yum install yum-plugin-priorities
sudo yum install kernel-devel
sudo yum install gcc gcc-c++ make patch
</code></pre>

<p>gitはソースから新しいのを入れる</p>

<pre><code>sudo yum install zlib-devel tcl-devel tk-devel gettext-devel curl-devel expat-devel openssl-devel
wget https://www.kernel.org/pub/software/scm/git/git-2.3.4.tar.gz
tar zxvf git-2.3.4.tar.gz
cd git-2.3.4
./configure --with-curl=/usr/bin --prefix=/usr/local
make prefix=/usr/local all
sudo make prefix=/usr/local install
</code></pre>

<h2 id="section-1">カードリーダー関連</h2>

<pre><code>yum install pcsc-lite pcsc-lite-devel pcsc-lite-libs
yum install ccid
</code></pre>

<p>perl-gtkはRPMForgeから入れる</p>

<pre><code>wget http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm
sudo rpm --import http://apt.sw.be/RPM-GPG-KEY.dag.txt
sudo rpm -K rpmforge-release-0.5.3-1.el6.rf.*.rpm (Verify)
sudo rpm -K rpmforge-release-0.5.3-1.el6.rf.*.rpm (Install)
yum install --enablerepo=rpmforge -y perl-Gtk2
</code></pre>

<p>pcsc-perlはソースから</p>

<pre><code>wget http://ludovic.rousseau.free.fr/softwares/pcsc-perl/pcsc-perl-1.4.13.tar.bz2
tar xf pcsc-perl-1.4.13.tar.bz2
cd pcsc-perl-1.4.13
perl Makefile.PL PREFIX=/usr SITELIBEXP=/usr/share/perl5 SITEARCHEXP=/usr/lib64/perl5
make
sudo make install
</code></pre>

<p>pcsc-toolsもソースから</p>

<pre><code>wget http://ludovic.rousseau.free.fr/softwares/pcsc-tools/pcsc-tools-1.4.22.tar.gz
tar xf pcsc-tools-1.4.22.tar.gz
cd pcsc-tools-1.4.22
make
sudo make install DESTDIR=/usr
</code></pre>

<p>サービス設定</p>

<pre><code>sudo service messagebus start
sudo service haldaemon start
sudo service pcscd start
sudo chkconfig messagebus on
sudo chkconfig haldaemon on
sudo chkconfig pcscd on
</code></pre>

<p>openctが競合するらしいので止める</p>

<pre><code>sudo service openct stop
sudo chkconfig openct off
</code></pre>

<p><code>pcsc_scan</code>を実行して動作チェック</p>

<ul>
  <li><code>Japanese Chijou Digital B-CAS Card (pay TV)</code>が出ればOK</li>
  <li><code>Ctrl+C</code>で終了</li>
</ul>

<h2 id="arib25">arib25</h2>

<pre><code>git clone git://github.com/stz2012/libarib25.git
make
sudo make install
</code></pre>

<h2 id="recpt1">recpt1</h2>

<pre><code>git clone https://github.com/stz2012/recpt1.git
cd ./recpt1/recpt1
./autogen.sh
./configure --enable-b25
make
sudo make install
</code></pre>

<p>動作チェック</p>

<pre><code>recpt1 --b25 27 10 test.ts
</code></pre>

<h2 id="pt3">PT3ドライバ</h2>

<p>標準ドライバを無効化</p>

<pre><code>vi /etc/modprobe.d/blacklist.conf
	"blacklist earth_pt1"を末尾に追加
</code></pre>

<p>インストール</p>

<pre><code>git clone git://github.com/m-tsudo/pt3.git
cd pt3
make
sudo make install
</code></pre>

<p>再起動して動作チェック</p>

<pre><code>sudo reboot now
ls /dev/ | grep pt3
	pt3video0-3が出ればOK
recpt1 --b25 --strip 11 10 /var/test.ts --device /dev/pt3video2
</code></pre>

<p>ライブラリが読めないエラーが出た</p>

<pre><code>ldd /usr/local/bin/recpt1	読めないライブラリを確認
sudo vi /etc/ld.so.conf		"/usr/local/lib"を末尾に追加
sudo ldconfig
ldd /usr/local/bin/recpt1
</code></pre>

<p>cannot start b25 decorderが出た</p>

<ul>
  <li>pcscdを再起動してみる</li>
</ul>

<h2 id="chinachu">chinachu</h2>

<p>yasmはepelから入れる</p>

<pre><code>wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
sudo rpm -Uvh epel-release-6-8.noarch.rpm
sudo vi /etc/yum.repos.d/epel.repo
	[epel]をenabled=0に
sudo yum install --enablerepo=epel yasm yasm-devel
</code></pre>

<p>chinachuユーザをつくる</p>

<pre><code>yum install autoconf automake libtool
sudo useradd chinachu
sudo su chinachu
cd
</code></pre>

<p>gitにパスを通す</p>

<pre><code>vi .bash_profile に/usr/local/binを追記
source .bash_profile
</code></pre>

<p>chinachuのダウンロード</p>

<pre><code>git clone git://github.com/kanreisa/Chinachu.git ~/chinachu
cd chinachu
</code></pre>

<p>pkgconfigにもパスを通す</p>

<pre><code>export PKG_CONFIG_PATH=/home/chinachu/chinachu/usr/lib/pkgconfig
echo $PKG_CONFIG_PATH
</code></pre>

<p>インストーラ実行</p>

<pre><code>./chinachu installer
	1) Auto (full)
./chinachu service operator initscript &gt; /tmp/chinachu-operator
./chinachu service wui initscript &gt; /tmp/chinachu-wui
exit(もとのユーザに戻る)
</code></pre>

<p>サービス登録</p>

<pre><code>mv /tmp/chinachu-operator /tmp/chinachu-wui /etc/init.d/
chown root:root /etc/init.d/chinachu-operator /etc/init.d/chinachu-wui
chmod +x /etc/init.d/chinachu-operator /etc/init.d/chinachu-wui
chkconfig -–add chinachu-operator
chkconfig –-add chinachu-wui
chkconfig chinachu-operator on
chkconfig chinachu-wui on
</code></pre>

<h2 id="section-2">参考</h2>

<ul>
  <li>http://d.hatena.ne.jp/kt_hiro/20130113/1358051168</li>
  <li>http://memo.saitodev.com/home/linux_pt2/recpt1/</li>
</ul>

	</body>
<html>
