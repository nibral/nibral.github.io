<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<title>CentOS 6インストールと初期設定</title>
		<link rel="stylesheet" href="/assets/css/style.css" type="text/css">
	</head>
	<body>
		<h1 id="centos-6">CentOS 6インストールと初期設定</h1>

<p>netinstallが終わって、rootでログインしたところから</p>

<h2 id="section">パッケージのアップデート</h2>

<pre><code>yum update
</code></pre>

<h2 id="su">suの設定変更</h2>

<p>suをwheelグループに限定</p>

<pre><code>vi /etc/pam.d/su
    -# auth required pam_wheel.so use_uid
    +auth required pam_wheel.so use_uid
</code></pre>

<p>sudoの設定</p>

<pre><code>visudo
    -# %wheel ALL=(ALL) ALL
    +%wheel ALL=(ALL) ALL
</code></pre>

<h2 id="section-1">作業用ユーザ作成</h2>

<p>ユーザ追加</p>

<pre><code>useradd -G wheel akari
</code></pre>

<p>パスワード変更</p>

<pre><code>passwd akari
</code></pre>

<h2 id="ssh">SSHの設定</h2>

<p><strong>SSHクライアントを使って、作業用ユーザでログイン(22番ポート)</strong></p>

<p>ssh鍵作成</p>

<pre><code>ssh-keygen
cp .ssh/id_rsa.pub .ssh/authorized_keys
chmod 600 .ssh/authorized_keys
</code></pre>

<p>手元の端末に秘密鍵を持ってくる</p>

<pre><code>cat .ssh/id_rsa
</code></pre>

<p><strong>作業用ユーザからログアウト、rootに戻る</strong></p>

<p>sshdの設定変更(ポート変更、rootログイン無効、鍵認証を強制)</p>

<pre><code>vi /etc/ssh/sshd_config
    Port 10022
    PermitRootLogin no
    PasswordAuthenication no
    AuthorizedKeysFile .ssh/authorized_keys
</code></pre>

<h2 id="section-2">ファイアウォールの設定</h2>

<p>必要パッケージのインストール</p>

<pre><code>yum install dbus dbus-python
chkconfig messagebus on
/etc/init.d/messagebus start
</code></pre>

<p>ファイアウォール設定ツールインストール</p>

<pre><code>yum install system-config-firewall-tui
</code></pre>

<p>起動</p>

<pre><code>system-config-firewall-tui
    Customizeを選び、必要なポートを開ける
    終わったらClose→OK
</code></pre>

<p>SSHに印をつけて22番ポートを開けると攻撃される可能性があるので、
“Other Ports”で別のポートをSSH用に開けるとよい(10022番とか)</p>

<p><strong>生成される<code>/etc/sysconfig/iptables</code>の例</strong>(http,https,10022)</p>

<pre><code># Firewall configuration written by system-config-firewall
# Manual customization of this file is not recommended.
＊filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 443 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 10022 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
</code></pre>

<h2 id="selinux">SELinuxを切る</h2>

<p>SELinuxが入っていると制限がきついので切る(sshのポートを変えたときに通信できないとか)</p>

<pre><code>vi /etc/selinux/config
    SELINUX=disabled
</code></pre>

<h2 id="section-3">全部おわったら再起動</h2>

<pre><code>reboot now
</code></pre>

	</body>
<html>
