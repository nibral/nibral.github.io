---
title: "Raspberry Pi 2 Model B + WDC-150SU2Mで無線LANに接続する"
date: 2015-12-14T12:00:00+09:00
---

やるべきこと
----
* WDC-150SU2M(=Realtek 8188eu)のドライバをインストール
* dhcphdとwpa_suppcilantでネットワークに接続


ドライバのインストール
====

WDC-150SU2M(=Realtek 8188eu)のドライバをインストールして、ネットワークに接続する。

Raspbian更新
----
    sudo apt-get update
    sudo apt-get upgrade

ファームウェア更新
----
    rpi-update

Linuxバージョン確認
----
    uname -a

表示されたバージョン番号を確認する。(2015/12/8時点では4.1.13-v7+ #826)

ドライバダウンロード
----
[https://www.raspberrypi.org/forums/viewtopic.php?p=462982](https://www.raspberrypi.org/forums/viewtopic.php?p=462982)から対応するバージョンのファイル名(8188eu-v7-yyyymmdd.tar.gz)を探す。PiとPi2でファイルが違うので注意。

ドライバインストール
----
    wget https://dl.dropboxusercontent.com/u/80256631/8188eu-v7-2015yyzz.tar.gz
    tar xzf 8188eu-v7-yyyymmdd.tar.gz
    ./install.sh

再起動
----
    sudo reboot now

認識していることを確認
----
    lsusb

"ID 056e:4008 Elecom Co., Ltd"が表示されていれば正常に認識されている。


ネットワークに接続
====

プロファイル作成
----
```/etc/wpa_supplicant/wpa_supplicant.conf```を作成する。

{% gist 944802d888a5d5536559 %}

```network={...}```の部分は```wpa_passphrase 接続したいSSID パスワード```を実行して生成できる。
コマンドの出力にはコメントとしてパスワードの平文が含まれている(#psk=...)ので、心配なら削除する。

接続
----
標準で動いているdhcpcdは特定の名前が付いた設定ファイルを自動で読み込むので([dhcpcd#10-wpa_supplicant - ArchWiki](https://wiki.archlinuxjp.org/index.php/Dhcpcd#10-wpa_supplicant))、dhcpcdを再起動すれば接続できるはず。

    sudo systemctl daemon-reload
    sudo service dhcpcd restart

うまくいかない場合は```wpa_cli```で対話型の設定コンソールが開いて何とかする。

固定IP
----
dhcpcdの設定と競合するので```/etc/network/interfaces```は書き換えない。
dhcpcdの設定ファイル```/etc/dhcpcd.conf```の末尾に下記の設定を追記するか、DHCPサーバ側でリースするIPを固定する。

    interface wlan0
    static ip_address=192.168.0.81/24
    static routers=192.168.0.1
    static domain_name_servers=192.168.0.1

ただ、標準でavahiが動いていて"raspberypi.local"でアクセスできるのでサーバ運用しないならIPを固定する必要はない気がする。
(WindowsではBonjourが必要だが、[単体のインストーラが提供されている。](https://support.apple.com/downloads/Bonjour_for_Windows))
